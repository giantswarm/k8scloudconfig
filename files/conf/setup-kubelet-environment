#!/bin/bash
env_file="/etc/kubelet-environment"

# set max pods variable
{{ if .EnableAWSCNI -}}
# The maximum number of pods on AWS with aws-cni is defined by maximum ENI for instance and maximum IPs per ENI. Check this link
# This is just simplifying the whole formula. Small instances can have less ENIs and less IPs per ENI.
# https://github.com/aws/amazon-vpc-cni-k8s#eni-allocation
# https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html

instance_type="$(curl http://169.254.169.254/latest/meta-data/instance-type 2>/dev/null)"

# Cases are generated with:
#
#    curl -fsSLo - https://raw.githubusercontent.com/awslabs/amazon-eks-ami/2e1f63f951c82a76fd20b19b811592535962c82d/files/eni-max-pods.txt | grep -v '^#' | sed -E 's/([[:alnum:]]+)[[:space:]]+([[:digit:]]+)/\1)|MAX_PODS=$((\2|- $reserved_ips)) ;;/' | column -t -s '|'
#
reserved_ips=5
case $instance_type in
a1.medium)      MAX_PODS=$((8    - $reserved_ips)) ;;
a1.large)       MAX_PODS=$((29   - $reserved_ips)) ;;
a1.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
a1.2xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
a1.4xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
c1.medium)      MAX_PODS=$((12   - $reserved_ips)) ;;
c1.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
c3.large)       MAX_PODS=$((29   - $reserved_ips)) ;;
c3.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
c3.2xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
c3.4xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
c3.8xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
c4.large)       MAX_PODS=$((29   - $reserved_ips)) ;;
c4.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
c4.2xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
c4.4xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
c4.8xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
c5.large)       MAX_PODS=$((29   - $reserved_ips)) ;;
c5.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
c5.2xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
c5.4xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
c5.9xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
c5.12xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
c5.18xlarge)    MAX_PODS=$((737  - $reserved_ips)) ;;
c5.24xlarge)    MAX_PODS=$((737  - $reserved_ips)) ;;
c5.metal)       MAX_PODS=$((737  - $reserved_ips)) ;;
c5a.large)      MAX_PODS=$((29   - $reserved_ips)) ;;
c5a.xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
c5a.2xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
c5a.4xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
c5a.8xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
c5a.12xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
c5a.16xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
c5a.24xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
c5a.metal)      MAX_PODS=$((737  - $reserved_ips)) ;;
c5ad.large)     MAX_PODS=$((29   - $reserved_ips)) ;;
c5ad.xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
c5ad.2xlarge)   MAX_PODS=$((58   - $reserved_ips)) ;;
c5ad.4xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
c5ad.8xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
c5ad.12xlarge)  MAX_PODS=$((234  - $reserved_ips)) ;;
c5ad.16xlarge)  MAX_PODS=$((737  - $reserved_ips)) ;;
c5ad.24xlarge)  MAX_PODS=$((737  - $reserved_ips)) ;;
c5ad.metal)     MAX_PODS=$((737  - $reserved_ips)) ;;
c5d.large)      MAX_PODS=$((29   - $reserved_ips)) ;;
c5d.xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
c5d.2xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
c5d.4xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
c5d.9xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
c5d.12xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
c5d.18xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
c5d.24xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
c5d.metal)      MAX_PODS=$((737  - $reserved_ips)) ;;
c5n.large)      MAX_PODS=$((29   - $reserved_ips)) ;;
c5n.xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
c5n.2xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
c5n.4xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
c5n.9xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
c5n.18xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
cc2.8xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
cr1.8xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
d2.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
d2.2xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
d2.4xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
d2.8xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
f1.2xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
f1.4xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
f1.16xlarge)    MAX_PODS=$((242  - $reserved_ips)) ;;
g2.2xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
g2.8xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
g3s.xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
g3.4xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
g3.8xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
g3.16xlarge)    MAX_PODS=$((452  - $reserved_ips)) ;;
g4dn.xlarge)    MAX_PODS=$((29   - $reserved_ips)) ;;
g4dn.2xlarge)   MAX_PODS=$((29   - $reserved_ips)) ;;
g4dn.4xlarge)   MAX_PODS=$((29   - $reserved_ips)) ;;
g4dn.8xlarge)   MAX_PODS=$((58   - $reserved_ips)) ;;
g4dn.16xlarge)  MAX_PODS=$((58   - $reserved_ips)) ;;
g4dn.12xlarge)  MAX_PODS=$((234  - $reserved_ips)) ;;
g4dn.metal)     MAX_PODS=$((737  - $reserved_ips)) ;;
h1.2xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
h1.4xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
h1.8xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
h1.16xlarge)    MAX_PODS=$((452  - $reserved_ips)) ;;
hs1.8xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
i2.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
i2.2xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
i2.4xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
i2.8xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
i3.large)       MAX_PODS=$((29   - $reserved_ips)) ;;
i3.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
i3.2xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
i3.4xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
i3.8xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
i3.16xlarge)    MAX_PODS=$((452  - $reserved_ips)) ;;
i3.metal)       MAX_PODS=$((737  - $reserved_ips)) ;;
i3en.large)     MAX_PODS=$((29   - $reserved_ips)) ;;
i3en.xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
i3en.2xlarge)   MAX_PODS=$((58   - $reserved_ips)) ;;
i3en.3xlarge)   MAX_PODS=$((58   - $reserved_ips)) ;;
i3en.6xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
i3en.12xlarge)  MAX_PODS=$((234  - $reserved_ips)) ;;
i3en.24xlarge)  MAX_PODS=$((737  - $reserved_ips)) ;;
inf1.xlarge)    MAX_PODS=$((38   - $reserved_ips)) ;;
inf1.2xlarge)   MAX_PODS=$((38   - $reserved_ips)) ;;
inf1.6xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
inf1.24xlarge)  MAX_PODS=$((437  - $reserved_ips)) ;;
m1.small)       MAX_PODS=$((8    - $reserved_ips)) ;;
m1.medium)      MAX_PODS=$((12   - $reserved_ips)) ;;
m1.large)       MAX_PODS=$((29   - $reserved_ips)) ;;
m1.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
m2.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
m2.2xlarge)     MAX_PODS=$((118  - $reserved_ips)) ;;
m2.4xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
m3.medium)      MAX_PODS=$((12   - $reserved_ips)) ;;
m3.large)       MAX_PODS=$((29   - $reserved_ips)) ;;
m3.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
m3.2xlarge)     MAX_PODS=$((118  - $reserved_ips)) ;;
m4.large)       MAX_PODS=$((20   - $reserved_ips)) ;;
m4.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
m4.2xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
m4.4xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
m4.10xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
m4.16xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
m5.large)       MAX_PODS=$((29   - $reserved_ips)) ;;
m5.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
m5.2xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
m5.4xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
m5.8xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
m5.12xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
m5.16xlarge)    MAX_PODS=$((737  - $reserved_ips)) ;;
m5.24xlarge)    MAX_PODS=$((737  - $reserved_ips)) ;;
m5.metal)       MAX_PODS=$((737  - $reserved_ips)) ;;
m5a.large)      MAX_PODS=$((29   - $reserved_ips)) ;;
m5a.xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
m5a.2xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
m5a.4xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
m5a.8xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
m5a.12xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
m5a.16xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
m5a.24xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
m5ad.large)     MAX_PODS=$((29   - $reserved_ips)) ;;
m5ad.xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
m5ad.2xlarge)   MAX_PODS=$((58   - $reserved_ips)) ;;
m5ad.4xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
m5ad.12xlarge)  MAX_PODS=$((234  - $reserved_ips)) ;;
m5ad.24xlarge)  MAX_PODS=$((737  - $reserved_ips)) ;;
m5d.large)      MAX_PODS=$((29   - $reserved_ips)) ;;
m5d.xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
m5d.2xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
m5d.4xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
m5d.8xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
m5d.12xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
m5d.16xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
m5d.24xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
m5d.metal)      MAX_PODS=$((737  - $reserved_ips)) ;;
m5dn.large)     MAX_PODS=$((29   - $reserved_ips)) ;;
m5dn.xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
m5dn.2xlarge)   MAX_PODS=$((58   - $reserved_ips)) ;;
m5dn.4xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
m5dn.8xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
m5dn.12xlarge)  MAX_PODS=$((234  - $reserved_ips)) ;;
m5dn.16xlarge)  MAX_PODS=$((737  - $reserved_ips)) ;;
m5dn.24xlarge)  MAX_PODS=$((737  - $reserved_ips)) ;;
m5n.large)      MAX_PODS=$((29   - $reserved_ips)) ;;
m5n.xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
m5n.2xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
m5n.4xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
m5n.8xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
m5n.12xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
m5n.16xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
m5n.24xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
m6g.medium)     MAX_PODS=$((8    - $reserved_ips)) ;;
m6g.large)      MAX_PODS=$((29   - $reserved_ips)) ;;
m6g.xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
m6g.2xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
m6g.4xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
m6g.8xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
m6g.12xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
m6g.16xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
p2.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
p2.8xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
p2.16xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
p3.2xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
p3.8xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
p3.16xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
p3dn.24xlarge)  MAX_PODS=$((737  - $reserved_ips)) ;;
r3.large)       MAX_PODS=$((29   - $reserved_ips)) ;;
r3.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
r3.2xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
r3.4xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
r3.8xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
r4.large)       MAX_PODS=$((29   - $reserved_ips)) ;;
r4.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
r4.2xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
r4.4xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
r4.8xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
r4.16xlarge)    MAX_PODS=$((452  - $reserved_ips)) ;;
r5.large)       MAX_PODS=$((29   - $reserved_ips)) ;;
r5.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
r5.2xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
r5.4xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
r5.8xlarge)     MAX_PODS=$((234  - $reserved_ips)) ;;
r5.12xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
r5.16xlarge)    MAX_PODS=$((737  - $reserved_ips)) ;;
r5.24xlarge)    MAX_PODS=$((737  - $reserved_ips)) ;;
r5.metal)       MAX_PODS=$((737  - $reserved_ips)) ;;
r5a.large)      MAX_PODS=$((29   - $reserved_ips)) ;;
r5a.xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
r5a.2xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
r5a.4xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
r5a.8xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
r5a.12xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
r5a.16xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
r5a.24xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
r5ad.large)     MAX_PODS=$((29   - $reserved_ips)) ;;
r5ad.xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
r5ad.2xlarge)   MAX_PODS=$((58   - $reserved_ips)) ;;
r5ad.4xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
r5ad.12xlarge)  MAX_PODS=$((234  - $reserved_ips)) ;;
r5ad.24xlarge)  MAX_PODS=$((737  - $reserved_ips)) ;;
r5d.large)      MAX_PODS=$((29   - $reserved_ips)) ;;
r5d.xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
r5d.2xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
r5d.4xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
r5d.8xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
r5d.12xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
r5d.16xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
r5d.24xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
r5d.metal)      MAX_PODS=$((737  - $reserved_ips)) ;;
r5dn.large)     MAX_PODS=$((29   - $reserved_ips)) ;;
r5dn.xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
r5dn.2xlarge)   MAX_PODS=$((58   - $reserved_ips)) ;;
r5dn.4xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
r5dn.8xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
r5dn.12xlarge)  MAX_PODS=$((234  - $reserved_ips)) ;;
r5dn.16xlarge)  MAX_PODS=$((737  - $reserved_ips)) ;;
r5dn.24xlarge)  MAX_PODS=$((737  - $reserved_ips)) ;;
r5n.large)      MAX_PODS=$((29   - $reserved_ips)) ;;
r5n.xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
r5n.2xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
r5n.4xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
r5n.8xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
r5n.12xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
r5n.16xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
r5n.24xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
t1.micro)       MAX_PODS=$((4    - $reserved_ips)) ;;
t2.nano)        MAX_PODS=$((4    - $reserved_ips)) ;;
t2.micro)       MAX_PODS=$((4    - $reserved_ips)) ;;
t2.small)       MAX_PODS=$((11   - $reserved_ips)) ;;
t2.medium)      MAX_PODS=$((17   - $reserved_ips)) ;;
t2.large)       MAX_PODS=$((35   - $reserved_ips)) ;;
t2.xlarge)      MAX_PODS=$((44   - $reserved_ips)) ;;
t2.2xlarge)     MAX_PODS=$((44   - $reserved_ips)) ;;
t3.nano)        MAX_PODS=$((4    - $reserved_ips)) ;;
t3.micro)       MAX_PODS=$((4    - $reserved_ips)) ;;
t3.small)       MAX_PODS=$((11   - $reserved_ips)) ;;
t3.medium)      MAX_PODS=$((17   - $reserved_ips)) ;;
t3.large)       MAX_PODS=$((35   - $reserved_ips)) ;;
t3.xlarge)      MAX_PODS=$((58   - $reserved_ips)) ;;
t3.2xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
t3a.nano)       MAX_PODS=$((4    - $reserved_ips)) ;;
t3a.micro)      MAX_PODS=$((4    - $reserved_ips)) ;;
t3a.small)      MAX_PODS=$((8    - $reserved_ips)) ;;
t3a.medium)     MAX_PODS=$((17   - $reserved_ips)) ;;
t3a.large)      MAX_PODS=$((35   - $reserved_ips)) ;;
t3a.xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
t3a.2xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
u-6tb1.metal)   MAX_PODS=$((147  - $reserved_ips)) ;;
u-9tb1.metal)   MAX_PODS=$((147  - $reserved_ips)) ;;
u-12tb1.metal)  MAX_PODS=$((147  - $reserved_ips)) ;;
x1.16xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
x1.32xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
x1e.xlarge)     MAX_PODS=$((29   - $reserved_ips)) ;;
x1e.2xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
x1e.4xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
x1e.8xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
x1e.16xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
x1e.32xlarge)   MAX_PODS=$((234  - $reserved_ips)) ;;
z1d.large)      MAX_PODS=$((29   - $reserved_ips)) ;;
z1d.xlarge)     MAX_PODS=$((58   - $reserved_ips)) ;;
z1d.2xlarge)    MAX_PODS=$((58   - $reserved_ips)) ;;
z1d.3xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
z1d.6xlarge)    MAX_PODS=$((234  - $reserved_ips)) ;;
z1d.12xlarge)   MAX_PODS=$((737  - $reserved_ips)) ;;
z1d.metal)      MAX_PODS=$((737  - $reserved_ips)) ;;
*)              MAX_PODS=40 ;;
esac

## We don't want to have more than 110 pods on a node even it would be possible by IP's.
if [ "$MAX_PODS" -gt "110" ];then
  MAX_PODS=110
fi

{{ else -}}
MAX_PODS=110
{{ end -}}

echo "MAX_PODS=${MAX_PODS}" >> ${env_file}
